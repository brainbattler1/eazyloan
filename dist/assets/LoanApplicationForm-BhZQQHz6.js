import{u as q,j as e,s as N}from"./index-DjnEXITF.js";import{r as m}from"./router-MjQpq3_0.js";import"./vendor-CSSWAZE4.js";import"./supabase-mDnqn92m.js";const O=({onClose:v})=>{const{user:c}=q(),[r,p]=m.useState({firstName:"",lastName:"",email:(c==null?void 0:c.email)||"",idNumber:"",passportNumber:"",gender:"",dateOfBirth:"",placeOfResidence:"",detailedAddress:"",phoneNumber:"",alternatePhone:"",workType:"",monthlyIncome:"",employmentStatus:"",creditScore:"",reference1FirstName:"",reference1LastName:"",reference1Phone:"",reference1Gender:"",reference1Relationship:"",reference2FirstName:"",reference2LastName:"",reference2Phone:"",reference2Gender:"",reference2Relationship:"",idCardFront:null,idCardBack:null,passport:null,loanAmount:"",loanPurpose:"",repaymentPeriod:"30",termMonths:"1"}),[y,g]=m.useState(!1),[C,P]=m.useState(!1),[b,i]=m.useState(""),[_,S]=m.useState("personal");m.useEffect(()=>{r.monthlyIncome&&console.log("Monthly income value updated:",r.monthlyIncome)},[r.monthlyIncome]);const a=n=>{const{name:s,value:l,type:t,files:d}=n.target;s==="monthlyIncome"&&console.log("Monthly income field changed:",{name:s,value:l,type:t}),p(o=>({...o,[s]:t==="file"?d[0]:l})),i("")},u=n=>{n.preventDefault(),n.stopPropagation();const{name:s,files:l}=n.target;l&&l[0]&&(p(t=>({...t,[s]:l[0]})),i(""))},f=async(n,s)=>{if(!n)return null;const l=n.name.split(".").pop(),t=`${c.id}/${s}.${l}`,{error:d}=await N.storage.from("loan-documents").upload(t,n,{cacheControl:"3600",upsert:!0});if(d)throw d;const{data:{publicUrl:o}}=N.storage.from("loan-documents").getPublicUrl(t);return o},k=()=>{const n=["firstName","lastName","email","idNumber","gender","dateOfBirth","placeOfResidence","detailedAddress","phoneNumber","workType","monthlyIncome","employmentStatus","reference1FirstName","reference1LastName","reference1Phone","reference1Gender","reference1Relationship","reference2FirstName","reference2LastName","reference2Phone","reference2Gender","reference2Relationship","loanAmount","loanPurpose","repaymentPeriod","termMonths"];for(const s of n)if(!r[s])return i(`Please fill in the ${s.replace(/([A-Z])/g," $1").toLowerCase()} field.`),!1;return!r.idCardFront||!r.idCardBack?(i("Please upload both front and back of your ID card."),!1):!0},w=async n=>{if(n.preventDefault(),!!k()){g(!0),i(""),await new Promise(s=>setTimeout(s,50));try{const s=await f(r.idCardFront,"id_card_front"),l=await f(r.idCardBack,"id_card_back"),t=await f(r.passport,"passport"),d={user_id:c.id,user_email:c.email,user_name:`${r.firstName} ${r.lastName}`,first_name:r.firstName,last_name:r.lastName,id_number:r.idNumber,passport_number:r.passportNumber||null,gender:r.gender,date_of_birth:r.dateOfBirth,place_of_residence:r.placeOfResidence,detailed_address:r.detailedAddress,phone_number:r.phoneNumber,alternate_phone:r.alternatePhone||null,work_type:r.workType,monthly_income:parseFloat(r.monthlyIncome),employment_status:r.employmentStatus||r.workType,credit_score:r.creditScore?parseInt(r.creditScore):null,reference1_first_name:r.reference1FirstName,reference1_last_name:r.reference1LastName,reference1_phone:r.reference1Phone,reference1_gender:r.reference1Gender,reference1_relationship:r.reference1Relationship,reference2_first_name:r.reference2FirstName,reference2_last_name:r.reference2LastName,reference2_phone:r.reference2Phone,reference2_gender:r.reference2Gender,reference2_relationship:r.reference2Relationship,id_card_front_url:s,id_card_back_url:l,passport_url:t,amount:parseFloat(r.loanAmount),loan_amount_kes:parseFloat(r.loanAmount),purpose:r.loanPurpose,repayment_period_days:parseInt(r.repaymentPeriod),term_months:parseInt(r.termMonths),status:"pending",pdf_generated:!1};let o=0;const x=3;let F=!1;for(;!F&&o<x;)try{const{error:h}=await N.from("loan_applications").insert([d]);if(h){if(h.code==="23505"&&o<x-1){o++,await new Promise(j=>setTimeout(j,100+Math.random()*200));continue}throw h}F=!0,P(!0)}catch(h){if(o===x-1)throw h;o++,await new Promise(j=>setTimeout(j,100+Math.random()*200))}}catch(s){console.error("Loan application submission error:",s),s.code==="23505"?i("There was a conflict with your application. Please try submitting again."):i(s.message||"Submission failed. Please try again.")}finally{g(!1)}}},R=[{id:"personal",title:"Personal Info",icon:"üë§"},{id:"contact",title:"Contact & Work",icon:"üìû"},{id:"references",title:"References",icon:"üë•"},{id:"documents",title:"Documents",icon:"üìÑ"},{id:"loan",title:"Loan Details",icon:"üí∞"}],I=n=>{S(n);const s=document.getElementById(n);s&&s.scrollIntoView({behavior:"smooth",block:"start"})};return C?e.jsx("div",{className:"loan-form-container",children:e.jsxs("div",{className:"success-screen",children:[e.jsx("div",{className:"success-animation",children:e.jsx("div",{className:"checkmark",children:"‚úì"})}),e.jsx("h2",{children:"Application Submitted Successfully!"}),e.jsx("p",{children:"Your loan application has been received and is being reviewed. We'll contact you within 24 hours."}),e.jsx("button",{className:"primary-btn",onClick:v,children:"Close"})]})}):e.jsxs("div",{className:"loan-form-container",children:[e.jsxs("div",{className:"form-header",children:[e.jsx("button",{className:"close-btn",onClick:v,"aria-label":"Close",children:"√ó"}),e.jsx("h1",{children:"Quick Loan Application"}),e.jsx("p",{children:"Complete all sections to apply for your loan"})]}),e.jsx("div",{className:"section-nav",children:R.map(n=>e.jsxs("button",{className:`nav-pill ${_===n.id?"active":""}`,onClick:()=>I(n.id),children:[e.jsx("span",{className:"nav-icon",children:n.icon}),e.jsx("span",{className:"nav-text",children:n.title})]},n.id))}),e.jsxs("form",{className:"loan-form",onSubmit:w,children:[b&&e.jsxs("div",{className:"error-alert",children:[e.jsx("span",{className:"error-icon",children:"‚ö†Ô∏è"}),b]}),e.jsxs("section",{id:"personal",className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"üë§ Personal Information"}),e.jsx("p",{children:"Tell us about yourself"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"firstName",children:"First Name *"}),e.jsx("input",{id:"firstName",name:"firstName",type:"text",value:r.firstName,onChange:a,placeholder:"Enter your first name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lastName",children:"Last Name *"}),e.jsx("input",{id:"lastName",name:"lastName",type:"text",value:r.lastName,onChange:a,placeholder:"Enter your last name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email Address *"}),e.jsx("input",{id:"email",name:"email",type:"email",value:r.email,onChange:a,placeholder:"your.email@example.com",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"idNumber",children:"ID Card Number *"}),e.jsx("input",{id:"idNumber",name:"idNumber",type:"text",value:r.idNumber,onChange:a,placeholder:"Enter your ID number",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"passportNumber",children:"Passport Number (Optional)"}),e.jsx("input",{id:"passportNumber",name:"passportNumber",type:"text",value:r.passportNumber,onChange:a,placeholder:"Enter passport number if available"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"gender",children:"Gender *"}),e.jsxs("select",{id:"gender",name:"gender",value:r.gender,onChange:a,required:!0,children:[e.jsx("option",{value:"",children:"Select your gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"dateOfBirth",children:"Date of Birth *"}),e.jsx("input",{id:"dateOfBirth",name:"dateOfBirth",type:"date",value:r.dateOfBirth,onChange:a,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"placeOfResidence",children:"Place of Residence *"}),e.jsx("input",{id:"placeOfResidence",name:"placeOfResidence",type:"text",value:r.placeOfResidence,onChange:a,placeholder:"City, County",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"detailedAddress",children:"Detailed Address *"}),e.jsx("textarea",{id:"detailedAddress",name:"detailedAddress",value:r.detailedAddress,onChange:a,placeholder:"Street address, building, apartment number",rows:3,required:!0})]})]}),e.jsxs("section",{id:"contact",className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"üìû Contact & Employment"}),e.jsx("p",{children:"How can we reach you and your work details"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phoneNumber",children:"M-Pesa Phone Number *"}),e.jsx("input",{id:"phoneNumber",name:"phoneNumber",type:"tel",value:r.phoneNumber,onChange:a,placeholder:"0712345678",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"alternatePhone",children:"Alternate Phone Number"}),e.jsx("input",{id:"alternatePhone",name:"alternatePhone",type:"tel",value:r.alternatePhone,onChange:a,placeholder:"0712345678 (optional)"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"workType",children:"Type of Work *"}),e.jsx("input",{id:"workType",name:"workType",type:"text",value:r.workType,onChange:a,placeholder:"e.g., Teacher, Driver, Business Owner",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"employmentStatus",children:"Employment Status *"}),e.jsxs("select",{id:"employmentStatus",name:"employmentStatus",value:r.employmentStatus,onChange:a,required:!0,children:[e.jsx("option",{value:"",children:"Select employment status"}),e.jsx("option",{value:"employed",children:"Employed"}),e.jsx("option",{value:"self_employed",children:"Self Employed"}),e.jsx("option",{value:"business_owner",children:"Business Owner"}),e.jsx("option",{value:"freelancer",children:"Freelancer"}),e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"retired",children:"Retired"}),e.jsx("option",{value:"unemployed",children:"Unemployed"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"creditScore",children:"Credit Score (Optional)"}),e.jsx("input",{id:"creditScore",name:"creditScore",type:"number",value:r.creditScore,onChange:a,placeholder:"Enter your credit score (300-850)",min:"300",max:"850"}),e.jsx("small",{className:"field-hint",children:"If you know your credit score, it helps us process your application faster"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"monthlyIncome",children:"Monthly Income (KES) *"}),e.jsxs("div",{className:"input-with-clear",children:[e.jsx("input",{id:"monthlyIncome",name:"monthlyIncome",type:"number",value:r.monthlyIncome,onChange:a,placeholder:"Enter your monthly income (e.g., 50000)",min:"1000",step:"1000",autoComplete:"off",required:!0}),r.monthlyIncome&&e.jsx("button",{type:"button",className:"clear-btn",onClick:()=>p(n=>({...n,monthlyIncome:""})),title:"Clear income field",children:"√ó"})]}),e.jsx("small",{className:"field-hint",children:"Enter your actual monthly income in Kenyan Shillings"}),r.monthlyIncome&&parseFloat(r.monthlyIncome)<1e3&&e.jsx("small",{className:"field-error",children:"Income must be at least KES 1,000"})]})]}),e.jsxs("section",{id:"references",className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"üë• References"}),e.jsx("p",{children:"Provide two people who can vouch for you"})]}),e.jsxs("div",{className:"reference-group",children:[e.jsx("h3",{children:"Reference 1"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reference1FirstName",children:"First Name *"}),e.jsx("input",{id:"reference1FirstName",name:"reference1FirstName",type:"text",value:r.reference1FirstName,onChange:a,placeholder:"Reference first name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reference1LastName",children:"Last Name *"}),e.jsx("input",{id:"reference1LastName",name:"reference1LastName",type:"text",value:r.reference1LastName,onChange:a,placeholder:"Reference last name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reference1Phone",children:"Phone Number *"}),e.jsx("input",{id:"reference1Phone",name:"reference1Phone",type:"tel",value:r.reference1Phone,onChange:a,placeholder:"0712345678",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reference1Gender",children:"Gender *"}),e.jsxs("select",{id:"reference1Gender",name:"reference1Gender",value:r.reference1Gender,onChange:a,required:!0,children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reference1Relationship",children:"Relationship *"}),e.jsx("input",{id:"reference1Relationship",name:"reference1Relationship",type:"text",value:r.reference1Relationship,onChange:a,placeholder:"e.g., Friend, Colleague, Family",required:!0})]})]}),e.jsxs("div",{className:"reference-group",children:[e.jsx("h3",{children:"Reference 2"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reference2FirstName",children:"First Name *"}),e.jsx("input",{id:"reference2FirstName",name:"reference2FirstName",type:"text",value:r.reference2FirstName,onChange:a,placeholder:"Reference first name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reference2LastName",children:"Last Name *"}),e.jsx("input",{id:"reference2LastName",name:"reference2LastName",type:"text",value:r.reference2LastName,onChange:a,placeholder:"Reference last name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reference2Phone",children:"Phone Number *"}),e.jsx("input",{id:"reference2Phone",name:"reference2Phone",type:"tel",value:r.reference2Phone,onChange:a,placeholder:"0712345678",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reference2Gender",children:"Gender *"}),e.jsxs("select",{id:"reference2Gender",name:"reference2Gender",value:r.reference2Gender,onChange:a,required:!0,children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reference2Relationship",children:"Relationship *"}),e.jsx("input",{id:"reference2Relationship",name:"reference2Relationship",type:"text",value:r.reference2Relationship,onChange:a,placeholder:"e.g., Friend, Colleague, Family",required:!0})]})]})]}),e.jsxs("section",{id:"documents",className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"üìÑ Documents"}),e.jsx("p",{children:"Upload required identification documents"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"idCardFront",children:"ID Card Front *"}),e.jsxs("div",{className:"file-upload",children:[e.jsx("input",{id:"idCardFront",name:"idCardFront",type:"file",accept:"image/*,application/pdf",onChange:u,className:"file-input",required:!0}),e.jsxs("label",{htmlFor:"idCardFront",className:"file-label",onClick:n=>n.stopPropagation(),children:[e.jsx("span",{className:"file-icon",children:"üì∑"}),e.jsx("span",{className:"file-text",children:r.idCardFront?r.idCardFront.name:"Take Photo or Upload ID Front"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"idCardBack",children:"ID Card Back *"}),e.jsxs("div",{className:"file-upload",children:[e.jsx("input",{id:"idCardBack",name:"idCardBack",type:"file",accept:"image/*,application/pdf",onChange:u,className:"file-input",required:!0}),e.jsxs("label",{htmlFor:"idCardBack",className:"file-label",onClick:n=>n.stopPropagation(),children:[e.jsx("span",{className:"file-icon",children:"üì∑"}),e.jsx("span",{className:"file-text",children:r.idCardBack?r.idCardBack.name:"Take Photo or Upload ID Back"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"passport",children:"Passport (Optional)"}),e.jsxs("div",{className:"file-upload",children:[e.jsx("input",{id:"passport",name:"passport",type:"file",accept:"image/*,application/pdf",onChange:u,className:"file-input"}),e.jsxs("label",{htmlFor:"passport",className:"file-label",onClick:n=>n.stopPropagation(),children:[e.jsx("span",{className:"file-icon",children:"üìÑ"}),e.jsx("span",{className:"file-text",children:r.passport?r.passport.name:"Upload Passport (Optional)"})]})]})]})]}),e.jsxs("section",{id:"loan",className:"form-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"üí∞ Loan Details"}),e.jsx("p",{children:"Specify your loan requirements"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"loanAmount",children:"Loan Amount (KES) *"}),e.jsx("input",{id:"loanAmount",name:"loanAmount",type:"number",value:r.loanAmount,onChange:a,placeholder:"50000",min:"5000",max:"5000000",step:"100",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"loanPurpose",children:"Loan Purpose *"}),e.jsxs("select",{id:"loanPurpose",name:"loanPurpose",value:r.loanPurpose,onChange:a,required:!0,children:[e.jsx("option",{value:"",children:"Select loan purpose"}),e.jsx("option",{value:"business",children:"Business"}),e.jsx("option",{value:"education",children:"Education"}),e.jsx("option",{value:"medical",children:"Medical"}),e.jsx("option",{value:"home_improvement",children:"Home Improvement"}),e.jsx("option",{value:"debt_consolidation",children:"Debt Consolidation"}),e.jsx("option",{value:"emergency",children:"Emergency"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"termMonths",children:"Loan Term (Months) *"}),e.jsxs("select",{id:"termMonths",name:"termMonths",value:r.termMonths,onChange:a,required:!0,children:[e.jsx("option",{value:"1",children:"1 month"}),e.jsx("option",{value:"2",children:"2 months"}),e.jsx("option",{value:"3",children:"3 months"}),e.jsx("option",{value:"6",children:"6 months"}),e.jsx("option",{value:"12",children:"12 months"}),e.jsx("option",{value:"24",children:"24 months"}),e.jsx("option",{value:"36",children:"36 months"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"repaymentPeriod",children:"Repayment Period (Days) *"}),e.jsxs("select",{id:"repaymentPeriod",name:"repaymentPeriod",value:r.repaymentPeriod,onChange:a,required:!0,children:[e.jsx("option",{value:"7",children:"7 days"}),e.jsx("option",{value:"14",children:"14 days"}),e.jsx("option",{value:"30",children:"30 days"}),e.jsx("option",{value:"45",children:"45 days"}),e.jsx("option",{value:"60",children:"60 days"}),e.jsx("option",{value:"90",children:"90 days"})]})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"submit-btn",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"Submitting..."]}):"Submit Application"})})]})]})};export{O as default};
//# sourceMappingURL=LoanApplicationForm-BhZQQHz6.js.map
